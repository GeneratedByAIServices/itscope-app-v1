# 로그인 기능 요구사항 (v1)

## 1. 개요
본 문서는 기존 사용자가 서비스에 접근하기 위한 로그인 절차의 기능적 요구사항을 정의합니다. 로그인 흐름은 `이메일 확인`, `비밀번호 인증`, `2단계 인증(2FA)`의 순서로 진행됩니다.

---

## 2. 공통 요구사항

### 2.1. 다국어 지원 (Internationalization)
- **R-2.1.1**: 로그인 흐름의 모든 UI 텍스트(레이블, 버튼, 플레이스홀더 등)는 다국어(한국어, 영어)를 지원해야 한다.
- **R-2.1.2**: 모든 유효성 검사 오류 메시지와 서버 응답에 따른 토스트(Toast) 알림 메시지는 현재 설정된 언어로 표시되어야 한다.
- **R-2.1.3**: 언어 설정은 사용자의 브라우저 기본 언어를 따르며, 사용자가 플로팅 메뉴를 통해 직접 변경할 수 있어야 한다.

---

## 3. 1단계: 이메일 확인 (`EmailStep`)

### 3.1. 기능 요구사항
- **R-3.1.1**: 사용자는 이메일 주소를 입력해야 한다.
- **R-3.1.2**: 시스템은 입력된 이메일이 유효한 형식인지 실시간으로 검증해야 한다 (`validateEmail`).
- **R-3.1.3**: 시스템은 이메일 입력이 끝났을 때(debounce 500ms), 해당 이메일이 데이터베이스(`pm_user`)에 등록되어 있는지 자동으로 확인해야 한다 (`checkEmailExists`).
- **R-3.1.4**: 이메일이 등록된 경우, 입력 필드 오른쪽에 녹색 체크 아이콘을 표시하여 등록된 사용자임을 알려야 한다.
- **R-3.1.5**: 사용자가 '계속' 버튼을 클릭하면, 시스템은 등록 여부에 따라 다음 단계(`로그인` 또는 `회원가입`)로 분기해야 한다.

### 3.2. 편의 기능
- **R-3.2.1**: '다음에도 사용' 체크박스를 선택하면, 사용자의 이메일 주소를 `localStorage`에 저장하여 다음 방문 시 자동으로 입력되어야 한다.
- **R-3.2.2**: 'Google로 로그인/회원가입' 버튼이 제공되어야 한다 (현재는 "준비중" 알림만 표시).

---

## 4. 2단계: 비밀번호 인증 (`SigninStep`)

### 4.1. 기능 요구사항
- **R-4.1.1**: 이전 단계에서 입력한 이메일은 수정 불가능한 상태로 표시되어야 한다.
- **R-4.1.2**: 데이터베이스에서 조회한 사용자 이름은 개인정보 보호를 위해 마스킹 처리하여(`홍*동`) 표시해야 한다.
- **R-4.1.3**: 사용자는 비밀번호를 입력해야 한다.
- **R-4.1.4**: '계속' 버튼 클릭 시, 시스템은 입력된 비밀번호를 해시화하여 데이터베이스에 저장된 해시와 비교 검증해야 한다 (`bcrypt.compare`).
- **R-4.1.5**: 인증에 성공하면 '2단계 인증' 단계로 이동해야 한다.
- **R-4.1.6**: 인증에 실패하면 "비밀번호가 일치하지 않습니다." 와 같은 오류 메시지를 현재 설정된 언어에 맞춰 `toast` 알림으로 표시해야 한다.

### 4.2. 편의 기능
- **R-4.2.1**: '다른 계정으로 로그인' 버튼을 클릭하면, 이메일 입력 단계로 돌아가야 한다.
- **R-4.2.2**: '비밀번호를 잊으셨나요?' 링크를 클릭하면, 비밀번호 재설정 단계로 이동해야 한다 (현재는 `FindPasswordStep`으로 이동).
- **R-4.2.3**: '로그인 상태 유지' 체크박스 기능이 제공되어야 한다 (현재는 UI만 구현됨).

---

## 5. 3단계: 2단계 인증 (`TwoFactorStep`)

### 5.1. 기능 요구사항
- **R-5.1.1**: 사용자는 '앱 인증' 또는 'SMS 인증' 방식을 선택할 수 있다.
- **R-5.1.2**: 사용자는 6자리 인증 코드를 입력해야 한다.
- **R-5.1.3**: 시스템은 입력된 코드가 유효한지 검증해야 한다 (현재는 '123456'을 정답으로 처리하는 Mock 로직).
- **R-5.1.4**: 인증에 성공하면, '로그인 성공' 단계로 이동해야 한다.
- **R-5.1.5**: 인증에 실패하면 "인증 코드가 올바르지 않습니다." 라는 오류 메시지를 현재 설정된 언어에 맞춰 표시해야 한다.

### 5.2. 편의 기능
- **R-5.2.1**: '인증 코드 재전송' 버튼이 제공되어야 하며, 클릭 시 재전송되었음을 알리는 `toast` 알림을 현재 설정된 언어에 맞춰 표시해야 한다 (현재는 콘솔 로그만 기록).

---

## 6. 활동 로깅 (신규)

### 6.1. 기능 요구사항
- **R-6.1.1**: **(비밀번호 인증)** 인증 실패 시, 시스템은 `pm_user_account_log` 테이블에 'LoginFailed' 유형으로 활동 로그를 기록해야 한다. 또한 `pm_user` 테이블의 `failed_login_attempts` 카운트를 1 증가시켜야 한다.
- **R-6.1.2**: **(2단계 인증)** 인증 실패 시, 시스템은 `pm_user_account_log` 테이블에 'TfaFailed' 유형으로 활동 로그를 기록해야 한다.
- **R-6.1.3**: **(로그인 성공)** 최종 인증 성공 시, 시스템은 `pm_user_account_log` 테이블에 'LoginSuccess' 유형으로 활동 로그를 기록해야 한다. 또한 `pm_user` 테이블의 `last_login_at`을 현재 시간으로 업데이트하고 `failed_login_attempts`를 0으로 초기화해야 한다.
- **R-6.1.4**: **(로그아웃)** 사용자가 로그아웃할 경우, 'Logout' 유형의 활동 로그를 기록해야 한다. 